================================================================================
          مستند جامع توسعه، معماری و نگهداری فریم‌ورک Hasht
================================================================================
نسخه مستند: ۲.۰
تاریخ بازنگری: ۱۴ دسامبر ۲۰۲۵

فهرست مطالب:
۱. مقدمه و فلسفه معماری (چرا این شکلی است؟)
۲. کالبدشکافی ساختار (چه چیزی کجاست؟)
۳. آموزش‌های عملی و سناریوهای توسعه (چطور انجام دهم؟)
   - الف: افزودن تنظیمات جدید به کاستومایزر
   - ب: ساخت یک قالب برگه اختصاصی
   - ج: افزودن فایل CSS یا JS جدید
۴. استراتژی مدیریت نسخه با Git (ساب‌ماژول‌ها)

--------------------------------------------------------------------------------
۱. مقدمه و فلسفه معماری
--------------------------------------------------------------------------------
این سیستم یک "قالب وردپرس" معمولی نیست؛ بلکه یک "فریم‌ورک توسعه قالب" است.
هدف اصلی این معماری، حل مشکل "کپی-پیست" و "بروزرسانی سخت" در قالب‌های متعدد است.

ما سیستم را به دو بخش کاملاً مجزا تقسیم کرده‌ایم:

۱. هسته (Core): مغز متفکر سیستم.
   - شامل تمام منطق‌های پیچیده (کامپایلر CSS، کلاس‌های کاستومایزر، توابع کمکی).
   - این بخش در تمام پروژه‌های شما **یکسان** است.
   - هدف: اگر باگی در هسته رفع شد، با یک دستور Git در همه پروژه‌ها رفع شود.

۲. پوسته (Theme): ظاهر و هویت سایت.
   - شامل فایل‌های HTML/PHP (Viewها)، استایل‌های خاص پروژه و تنظیمات Tailwind.
   - این بخش برای هر مشتری **منحصر به فرد** است.

*** قانون طلایی: ***
هیچگاه فایل‌های داخل پوشه `_hasht_core` را برای یک پروژه خاص ویرایش نکنید.
اگر تغییری در آنجا می‌دهید، باید مطمئن باشید که این تغییر برای "همه" پروژه‌های آینده مفید است.

--------------------------------------------------------------------------------
۲. کالبدشکافی ساختار (Directory Structure)
--------------------------------------------------------------------------------

[THEME ROOT]
│
├── _hasht_core/ ....................... [قلمرو ممنوعه برای تغییرات اختصاصی]
│   │   (این پوشه یک مخزن Git جداگانه است)
│   │
│   ├── core.php ....................... فایل اصلی که تمام ماژول‌ها را فراخوانی می‌کند.
│   ├── modules/ ....................... ماژول‌های مستقل سیستم
│   │   ├── assets/ .................... مدیریت فایل‌های CSS/JS (Enqueue)
│   │   ├── customizer/ ................ قلب تنظیمات قالب
│   │   │   ├── logic.php .............. منطق ساخت کنترل‌ها
│   │   │   └── sections/ .............. [مهم] فایل‌های تعریف تنظیمات (رنگ، هدر و...)
│   │   └── tokens/ .................... سیستم تبدیل تنظیمات به متغیرهای CSS
│   │       └── compiler.php ........... کدی که آرایه‌های PHP را به فایل tokens.css تبدیل می‌کند.
│   └── views/ ......................... ویوهای سیستمی (مثل layout اصلی)
│
├── views/ ............................. [محل کار اصلی شما]
│   ├── layouts/ ....................... اسکلت‌بندی صفحات (Header + Footer)
│   │   └── base.php ................... لایوت اصلی که همه صفحات از آن ارث می‌برند.
│   ├── pages/ ......................... محتوای داخلی صفحات
│   │   └── home.php ................... مثلاً صفحه اصلی
│   └── partials/ ...................... اجزای کوچک و قابل استفاده مجدد (کارت‌ها، دکمه‌ها)
│
├── assets/ ............................ فایل‌های استاتیک پروژه
├── functions.php ...................... دروازه ورود وردپرس (فقط Core را لود می‌کند)
├── style.css .......................... شناسنامه قالب
└── tailwind.config.js ................. تنظیمات ظاهری (متصل به متغیرهای Core)

--------------------------------------------------------------------------------
۳. آموزش‌های عملی و سناریوهای توسعه
--------------------------------------------------------------------------------

سناریو الف: افزودن یک بخش تنظیمات جدید (مثلاً "شبکه‌های اجتماعی")
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
می‌خواهیم در کاستومایزر یک بخش جدید اضافه کنیم که کاربر لینک اینستاگرام را وارد کند.

۱. به مسیر `_hasht_core/modules/customizer/sections/` بروید.
۲. یک فایل جدید بسازید: `social.php`
۳. کد زیر را در آن قرار دهید:
   <?php
   return [
       'social_section' => [ // شناسه بخش
           'title' => 'شبکه‌های اجتماعی', // عنوان قابل نمایش
           'settings' => [
               'instagram_url' => [ // شناسه تنظیم
                   'label' => 'لینک اینستاگرام',
                   'type'  => 'text', // نوع فیلد (text, color, image, ...)
                   'default' => 'https://instagram.com',
               ],
           ]
       ]
   ];
۴. تمام! هسته به صورت خودکار فایل را می‌خواند و پنل را می‌سازد.
۵. نحوه استفاده در فایل‌های View:
   <a href="<?php echo get_theme_mod('instagram_url'); ?>">Instagram</a>


سناریو ب: ساخت یک قالب برگه اختصاصی (مثلاً "تماس با ما")
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
۱. در پوشه `views/pages/` فایل `contact.php` را بسازید.
۲. محتوا را تعریف کنید:
   <?php
   // شروع سکشن محتوا
   core_start_section('content');
   ?>
       <div class="container mx-auto">
           <h1>تماس با ما</h1>
           <p>لطفا فرم زیر را پر کنید...</p>
       </div>
   <?php
   // پایان سکشن و ارسال به لایوت اصلی
   core_end_section();
   // فراخوانی لایوت مادر
   core_view('layouts.base');
   ?>
3. حالا باید یک Page Template وردپرس بسازید که این ویو را صدا بزند.
   در ریشه قالب فایل `page-contact.php` بسازید و در آن بنویسید:
   <?php core_view('pages.contact'); ?>


سناریو ج: افزودن یک فایل JS خارجی (مثلاً کتابخانه Swiper)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
۱. فایل `swiper.min.js` را در پوشه `assets/js/` پروژه کپی کنید.
۲. فایل `functions.php` (در ریشه قالب، نه هسته) را باز کنید.
۳. از هوک وردپرس استفاده کنید:
   add_action('wp_enqueue_scripts', function() {
       wp_enqueue_script(
           'my-swiper', 
           get_template_directory_uri() . '/assets/js/swiper.min.js', 
           [], 
           '1.0', 
           true // لود در فوتر
       );
   });

--------------------------------------------------------------------------------
۴. استراتژی مدیریت نسخه با Git (ساب‌ماژول‌ها)
--------------------------------------------------------------------------------

شما ۳ مخزن (Repository) دارید:

۱. مخزن Core (هسته):
   - فقط شامل پوشه `_hasht_core`.
   - وقتی آپدیت می‌شود که یک قابلیت **عمومی** اضافه کرده باشید.

۲. مخزن Starter (قالب مادر):
   - شامل ساختار اولیه + لینک به مخزن Core.
   - وقتی آپدیت می‌شود که بخواهید ساختار پایه پروژه‌های آینده را تغییر دهید.

۳. مخزن پروژه (Project Repo):
   - شامل کدهای نهایی یک سایت خاص.

دستورات پرکاربرد:

- وقتی پروژه جدیدی را کلون می‌کنید و پوشه _hasht_core خالی است:
  `git submodule update --init --recursive`

- وقتی تغییراتی در هسته داده‌اید و می‌خواهید آخرین نسخه را در پروژه خود بگیرید:
  `git submodule update --remote`

- بررسی وضعیت هسته (روی چه کامیتی است):
  `git submodule status`